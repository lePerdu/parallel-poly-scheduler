# Parallel and Distributed Computing Project

# We use C++11
CXXFLAGS += -std=c++11

MPICXX ?= mpiCC

# MPI-specific flags
MPI_CXXFLAGS ?=
MPI_LDFLAGS ?=

# Combine them for simplicity
CXXFLAGS += $(MPI_CXXFLAGS)
LDFLAGS += $(MPI_LDFLAGS)

# JSON library includes
NLOHMANN_JSON := nlohmann_json
CXXFLAGS += -I$(NLOHMANN_JSON)/single_include

SRC := src
BUILD := build
BIN := bin
TEST := test

TARGET := $(BIN)/parallel_scheduler

SOURCES := $(wildcard $(SRC)/*.cpp)
OBJECTS := $(patsubst $(SRC)/%.cpp,$(BUILD)/%.o,$(SOURCES))

all: $(TARGET)

$(TARGET): $(OBJECTS) | $(BIN)
	$(MPICXX) $(LDFLAGS) -o $@ $^

$(BUILD)/%.o: $(SRC)/%.cpp | $(BUILD)
	$(MPICXX) $(CXXFLAGS) -MMD -c -o $@ $<

$(BUILD):
	@mkdir -p $@

$(BIN):
	@mkdir -p $@

format:
	$(CLANG_FORMAT) -i $(SRC)/* $(TEST)/*

clean:
	rm -rf $(BUILD) $(BIN)

.PHONY: all format clean

# Include dependency files generated by the compiler (see -MMD option)
-include $(BUILD)/*.d
